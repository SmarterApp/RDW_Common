package org.opentestsystem.rdw.archive;

import org.opentestsystem.rdw.multitenant.TenantContextHolder;
import org.opentestsystem.rdw.multitenant.TenantIdResolver;
import org.opentestsystem.rdw.multitenant.TenantKeyResolver;
import org.opentestsystem.rdw.multitenant.TenantProperties;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.Optional;

@Configuration
public class TestConfiguration {

    @Bean
    TenantIdResolver tenantIdResolver() {
        return () -> Optional.ofNullable(TenantContextHolder.getTenantId());
    }

    @Bean
    @ConfigurationProperties(prefix = "tenantProperties")
    TenantProperties tenantProperties() {
        return new TenantProperties();
    }

    @Bean
    TenantKeyResolver tenantKeyResolver(TenantProperties tenantProperties, TenantIdResolver tenantIdResolver) {
        return new TenantKeyResolver(tenantProperties, tenantIdResolver);
    }

    @Bean
    @ConfigurationProperties(prefix = "archive")
    ArchivePropertiesRoot archivePropertiesRoot() {
        return new ArchivePropertiesRoot();
    }

    @Bean
    ArchivePropertiesResolver archivePropertiesResolver(TenantKeyResolver tenantKeyResolver,
                                                        ArchivePropertiesRoot archivePropertiesRoot) {
        return new ArchivePropertiesResolver(tenantKeyResolver, archivePropertiesRoot);
    }

}
