package org.opentestsystem.rdw.model;


import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;

public class TDSReportTest {

    @org.junit.Test
    public void thisTestEnforcesModelClasses() {
        // The idea of this test is to explicitly use the various model classes so that any change
        // in them will result in a compilation error; this is because the real client of this code
        // is in another project and we don't want to wait that long to discover breaking changes.

        final TDSReport tdsReport = XmlUtils.tdsReportFromXml(this.getClass().getResourceAsStream("/TDSReport.sample.xml"));
        assertThat(tdsReport).isNotNull();

        final Test test = tdsReport.getTest();
        assertThat(test).isNotNull();

        final Examinee examinee = tdsReport.getExaminee();
        assertThat(examinee).isNotNull();

        final Opportunity opportunity = tdsReport.getOpportunity();
        assertThat(opportunity).isNotNull();

        final List<Comment> comments = tdsReport.getComment();
        assertThat(comments).isNotNull();

        final List<ToolUsage> toolUsages = tdsReport.getToolUsage();
        assertThat(toolUsages).isNotNull();
    }

    @org.junit.Test
    public void itShouldGetBestAttribute() {
        final TDSReport tdsReport = XmlUtils.tdsReportFromXml(this.getClass().getResourceAsStream("/TDSReport.sample2.xml"));
        final Examinee examinee = tdsReport.getExaminee();

        assertThat(examinee.getBestAttribute("FirstName").getValue()).isEqualTo("LoadTest");
        assertThat(examinee.getBestAttribute("MiddleName").getValue()).isEqualTo("Fubar");
        assertThat(examinee.getBestAttribute("LastOrSurname").getValue()).isEqualTo("Student0000072");
        assertThat(examinee.getBestAttribute("Shoesize")).isNull();
    }

    @org.junit.Test
    public void itShouldGetBestRelationship() {
        final TDSReport tdsReport = XmlUtils.tdsReportFromXml(this.getClass().getResourceAsStream("/TDSReport.sample2.xml"));
        final Examinee examinee = tdsReport.getExaminee();

        assertThat(examinee.getBestRelationship("ResponsibleInstitutionIdentifier").getValue()).isEqualTo("2222");
        assertThat(examinee.getBestRelationship("ResponsibleDistrictIdentifier").getValue()).isEqualTo("1111");
        assertThat(examinee.getBestRelationship("StateAbbreviation").getValue()).isEqualTo("WI");
        assertThat(examinee.getBestRelationship("NotAThing")).isNull();
    }

//    // this is a test that loads external TDSReports that can't be checked in with source
//    @org.junit.Test
//    public void testExternalReports() throws FileNotFoundException {
//        final File srcdir = new File("/Users/marklaffoon/Downloads/Users/jefftreuting/dev/sb/trt-data");
//        for (final File file : srcdir.listFiles((dir, name) -> name.endsWith(".xml"))) {
//            System.out.println("LOADING " + file.getAbsolutePath());
//            try {
//                final TDSReport tdsReport = XmlUtils.tdsReportFromXml(new FileInputStream(file));
//                System.out.println("   TDSReport: " + XmlUtils.tdsReportToXml(tdsReport).substring(0, 80));
//            } catch (final Exception e) {
//                System.out.println("   Exception: " + e.getMessage());
//                throw e;
//            }
//        }
//    }
}