package org.opentestsystem.rdw.script;

import com.google.common.base.MoreObjects;
import org.opentestsystem.rdw.script.publishing.PublishedPipeline;

import java.time.Instant;
import java.util.List;

import static com.google.common.collect.ImmutableList.copyOf;

/**
 * Definition of a Pipeline including its name, version, node definitions, and roll back information.
 */
public class PipelineDefinition {

    private PublishedPipeline source;
    private List<ScriptDefinition> scripts;

    public PublishedPipeline getSource() {
        return source;
    }

    public List<ScriptDefinition> getScripts() {
        return scripts;
    }

    public String toString() {
        return MoreObjects.toStringHelper(this)
                .add("source", getSource())
                .add("scripts", getScripts())
                .toString();
    }

    public Builder copy() {
        return builder().copy(this);
    }

    public static Builder builder() {
        return new Builder();
    }

    public static class Builder {
        private PublishedPipeline source;
        private List<ScriptDefinition> scripts;

        public Builder source(final PublishedPipeline source) {
            this.source = source;
            return this;
        }

        public Builder scripts(final List<ScriptDefinition> scripts) {
            this.scripts = scripts != null ? copyOf(scripts) : null;
            return this;
        }

        protected PipelineDefinition build(final PipelineDefinition instance) {
            instance.source = source;
            instance.scripts = scripts;
            return instance;
        }

        public Builder copy(final PipelineDefinition value) {
            return source(value.source)
                    .scripts(scripts);
        }

        public PipelineDefinition build() {
            return build(new PipelineDefinition());
        }

    }
}
