package org.opentestsystem.rdw.script;

import java.time.Instant;
import java.util.Properties;

/**
 * Holds utility methods for published pipelines
 */
public final class PipelineDefinitions {

    // Note the property keys had to be all lower case due to the way Amazon S3 coerces all property names to lower case
    private static final String PipelineCodeProperty = "pipeline_code";
    private static final String VersionProperty = "version";
    private static final String PublishedOnProperty = "published_on";
    private static final String PublishedByProperty = "published_by";

    /**
     * Creates a set of properties representative of the provided pipeline.
     * This does not include script information.
     *
     * @param pipeline The published pipeline to turn into properties
     * @return The properties of the published pipeline
     */
    public static Properties toProperties(final PipelineDefinition pipeline) {
        final Properties properties = new Properties();
        properties.setProperty(PipelineCodeProperty, pipeline.getPipelineCode());
        properties.setProperty(VersionProperty, pipeline.getVersion());
        properties.setProperty(PublishedOnProperty, pipeline.getPublished().toString());
        properties.setProperty(PublishedByProperty, pipeline.getPublishedBy());
        return properties;
    }

    /**
     * Creates a published pipeline instance from the provided properties.
     * This does not include script information.
     *
     * @param properties The properties to produce the pipeline from
     * @return The published pipeline created from the provided properties
     */
    public static PipelineDefinition toPublishedPipeline(final Properties properties) {
        return PipelineDefinition.builder()
                .pipelineCode(properties.getProperty(PipelineCodeProperty))
                .version(properties.getProperty(VersionProperty))
                .published(Instant.parse(properties.getProperty(PublishedOnProperty)))
                .publishedBy(properties.getProperty(PublishedByProperty))
                .build();
    }

    private PipelineDefinitions() {}
}
