package org.opentestsystem.rdw.script;

import com.google.common.collect.ImmutableList;
import org.junit.Ignore;
import org.junit.Test;
import org.opentestsystem.rdw.script.publishing.PublishedPipeline;

import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.Mockito.mock;

public class PipelineDefinitionTest {

    @Test
    public void itShouldReturnBuilderValues() {
        final ScriptDefinition node = mock(ScriptDefinition.class);
        final PipelineDefinition definition = PipelineDefinition.builder()
                .source(
                        PublishedPipeline.builder()
                                .pipelineCode("test")
                                .version("23")
                                .build()
                )
                .scripts(ImmutableList.of(node))
                .build();

        assertThat(definition.getSource().getPipelineCode()).isEqualTo("test");
        assertThat(definition.getSource().getVersion()).isEqualTo("23");
        assertThat(definition.getScripts()).containsExactly(node);
    }

    @Test
    public void itShouldHaveReadableToString() {
        final PipelineDefinition definition = PipelineDefinition.builder()
                .source(
                        PublishedPipeline.builder()
                                .pipelineCode("test")
                                .version("23")
                                .build()
                )
                .build();

        assertThat(definition.toString())
                .contains(definition.getSource().getPipelineCode())
                .contains(definition.getSource().getVersion());
    }

    @Test
    @Ignore("is this a requirement?")
    public void equalsIsBasedOnlyOnTypeNameAndVersion() {
        final ScriptDefinition node = mock(ScriptDefinition.class);
        final PipelineDefinition one = PipelineDefinition.builder()
                .source(
                        PublishedPipeline.builder()
                                .pipelineCode("test")
                                .version("23")
                                .build()
                )
                .scripts(ImmutableList.of(node))
                .build();
        final PipelineDefinition two = PipelineDefinition.builder()
                .source(
                        PublishedPipeline.builder()
                                .pipelineCode("test")
                                .version("23")
                                .build()
                )
                .scripts(ImmutableList.of(node))
                .build();

        assertThat(one.equals(two)).isTrue();
        assertThat(one.hashCode()).isEqualTo(two.hashCode());
    }
}
