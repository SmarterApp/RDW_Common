package org.opentestsystem.rdw.script.util;

import com.google.common.collect.ImmutableMap;
import groovy.lang.MissingPropertyException;

import org.opentestsystem.rdw.script.PipelineScript;
import org.opentestsystem.rdw.script.PipelineScriptDefinition;
import org.opentestsystem.rdw.script.PipelineScriptType;

public class SamplePipelineScript extends PipelineScript {
    public SamplePipelineScript() {
    }

    public SamplePipelineScript(final PipelineScriptType type, final Object output, final RuntimeException exception) {
        this.source(PipelineScriptDefinition.builder()
                .type(type)
                .build());

        if (output != null) {
            this.bindProperties(ImmutableMap.of("output", output));
        }

        if (exception != null) {
            this.bindProperties(ImmutableMap.of("exception", exception));
        }
    }

    @Override
    public Object run() {
        try {
            final RuntimeException exception = (RuntimeException)this.getProperty("exception");
            if (exception != null) {
                throw exception;
            }
        } catch (MissingPropertyException | ClassCastException e) {
            // Ignore
        }

        try {
            return this.getProperty("output");
        } catch (MissingPropertyException e) {
            return null;
        }
    }
}
